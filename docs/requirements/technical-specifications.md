# ÊäÄË°ì‰ªïÊßòÊõ∏ - Technical Specifications

**ÊúÄÁµÇÊõ¥Êñ∞**: 2025-06-16  
**„Çπ„ÉÜ„Éº„Çø„Çπ**: Draft  
**ÊâøË™çËÄÖ**: [ÊäÄË°ìË≤¨‰ªªËÄÖÂêç]

---

## üèóÔ∏è „Ç∑„Çπ„ÉÜ„É†„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£

### ÂÖ®‰Ωì„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Client Layer                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ SwiftUI Views + MTKView + ARSCNView                     ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ PhotoEditor/                                        ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ Camera/                                             ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ ARGame/                                             ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ Social/                                             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                  ViewModel Layer                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ MVVM ViewModels + Combine                               ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ PhotoEditViewModel                                  ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ ARGameViewModel                                     ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ SocialViewModel                                     ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ AuthViewModel                                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                   Service Layer                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Core Services                                           ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ PhotoEditingService (Core Image)                   ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ ARLocationService (ARKit + Core Location)          ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ GameEngineService                                  ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ RealtimeService (Supabase)                         ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ ContentModerationService                           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                   Data Layer                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Supabase Backend + Local Storage                       ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ PostgreSQL Database                                ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ Real-time Subscriptions                            ‚îÇ
‚îÇ ‚îú‚îÄ‚îÄ File Storage                                       ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ Core Data (Local Cache)                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üì± „ÇØ„É©„Ç§„Ç¢„É≥„Éà„Çµ„Ç§„ÉâÊäÄË°ì‰ªïÊßò

### ÈñãÁô∫Áí∞Â¢ÉË¶Å‰ª∂
```swift
// ÊúÄÂ∞èË¶Å‰ª∂
iOS: 15.0+
Xcode: 15.0+
Swift: 5.9+
Device: iPhone 12+ (A14 Bionic+)

// Êé®Â•®Ë¶Å‰ª∂  
iOS: 17.0+
Device: iPhone 15+ (A17 Pro+)
Memory: 6GB+ RAM
Storage: 128GB+
```

### ‰∏ªË¶Å„Éï„É¨„Éº„É†„ÉØ„Éº„ÇØ
```swift
import SwiftUI          // UI Framework
import Combine          // Reactive Programming
import Core Image       // Image Processing
import Metal           // GPU Computing
import ARKit           // Augmented Reality
import Core Location   // Location Services
import Core ML         // Machine Learning
import Vision          // Computer Vision
import AVFoundation    // Camera/Audio
import Photos          // Photo Library
import CryptoKit       // Cryptography
```

### „Éó„É≠„Ç∏„Çß„ÇØ„ÉàÊßãÈÄ†
```
Couleur/
‚îú‚îÄ‚îÄ Application/
‚îÇ   ‚îú‚îÄ‚îÄ CouleurApp.swift
‚îÇ   ‚îú‚îÄ‚îÄ AppCoordinator.swift
‚îÇ   ‚îî‚îÄ‚îÄ AppEnvironment.swift
‚îú‚îÄ‚îÄ Core/
‚îÇ   ‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PhotoEditingService.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARLocationService.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameEngineService.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RealtimeService.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ContentModerationService.swift
‚îÇ   ‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ User.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Post.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GameSession.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ARTreasure.swift
‚îÇ   ‚îî‚îÄ‚îÄ Extensions/
‚îú‚îÄ‚îÄ Features/
‚îÇ   ‚îú‚îÄ‚îÄ PhotoEditor/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Views/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ViewModels/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Components/
‚îÇ   ‚îú‚îÄ‚îÄ ARGame/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Views/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ViewModels/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Components/
‚îÇ   ‚îú‚îÄ‚îÄ Camera/
‚îÇ   ‚îî‚îÄ‚îÄ Social/
‚îî‚îÄ‚îÄ Resources/
    ‚îú‚îÄ‚îÄ Filters/
    ‚îú‚îÄ‚îÄ AR Assets/
    ‚îî‚îÄ‚îÄ Localizations/
```

## üé® ÂÜôÁúüÁ∑®ÈõÜÊäÄË°ì‰ªïÊßò

### Core ImageÂÆüË£Ö

#### FilterEngineË®≠Ë®à
```swift
protocol FilterEngine {
    func applyFilter(_ filter: FilterType, to image: CIImage, intensity: Float) -> CIImage
    func createFilterChain(_ filters: [FilterConfiguration]) -> CIFilter
    func optimizeForRealtime(_ enable: Bool)
}

class RetroFilterEngine: FilterEngine {
    private let context: CIContext
    private let metalDevice: MTLDevice
    
    init() {
        self.metalDevice = MTLCreateSystemDefaultDevice()!
        self.context = CIContext(mtlDevice: metalDevice)
    }
    
    func applyVintageEffect(to image: CIImage) -> CIImage {
        // 1. Color Grading (LUT)
        let colorGraded = image.applyingFilter("CIColorCube", parameters: [
            "inputCubeData": vintageColorLUT
        ])
        
        // 2. Film Grain (Custom Metal Shader)
        let filmGrain = colorGraded.applyingFilter("CustomFilmGrain", parameters: [
            "inputIntensity": 0.3,
            "inputGrainSize": 1.2
        ])
        
        // 3. Vignette
        let vignette = filmGrain.applyingFilter("CIVignette", parameters: [
            "inputIntensity": 0.8,
            "inputRadius": 1.5
        ])
        
        return vignette
    }
}
```

#### „Ç´„Çπ„Çø„É†Metal„Ç∑„Çß„Éº„ÉÄ„Éº
```metal
// FilmGrain.metal
#include <metal_stdlib>
using namespace metal;

kernel void filmGrainEffect(texture2d<float, access::read> inTexture [[texture(0)]],
                           texture2d<float, access::write> outTexture [[texture(1)]],
                           constant float &intensity [[buffer(0)]],
                           constant float &grainSize [[buffer(1)]],
                           uint2 gid [[thread_position_in_grid]]) {
    
    float2 textureSize = float2(inTexture.get_width(), inTexture.get_height());
    float2 uv = float2(gid) / textureSize;
    
    // „É©„É≥„ÉÄ„É†„Éé„Ç§„Ç∫ÁîüÊàê
    float noise = random(uv * grainSize);
    
    // ÂÖÉÁîªÂÉèËâ≤ÂèñÂæó
    float4 color = inTexture.read(gid);
    
    // „Ç∞„É¨„Ç§„É≥ÈÅ©Áî®
    color.rgb += (noise - 0.5) * intensity;
    
    outTexture.write(color, gid);
}
```

#### LUT„Éó„É≠„Çª„ÉÉ„Çµ„Éº
```swift
class LUTProcessor {
    private static let lutSize = 64
    
    func loadVintageLUT() -> Data {
        // Kodak PortraÈ¢®LUT
        // 3D Color Lookup Table (64x64x64)
        var lutData = Data()
        
        for blue in 0..<lutSize {
            for green in 0..<lutSize {
                for red in 0..<lutSize {
                    let r = Float(red) / Float(lutSize - 1)
                    let g = Float(green) / Float(lutSize - 1)
                    let b = Float(blue) / Float(lutSize - 1)
                    
                    // Vintage color mapping
                    let transformedColor = applyVintageTransform(r: r, g: g, b: b)
                    
                    lutData.append(contentsOf: [
                        UInt8(transformedColor.r * 255),
                        UInt8(transformedColor.g * 255),
                        UInt8(transformedColor.b * 255),
                        255
                    ])
                }
            }
        }
        
        return lutData
    }
}
```

## üéÆ AR„Ç≤„Éº„Éü„Éï„Ç£„Ç±„Éº„Ç∑„Éß„É≥ÊäÄË°ì‰ªïÊßò

### ARKitÁµ±Âêà

#### ARÂÆùÊé¢„Åó„Ç∑„Çπ„ÉÜ„É†
```swift
class ARTreasureHuntManager: NSObject {
    private var sceneView: ARSCNView
    private var locationManager: CLLocationManager
    private var treasures: [ARTreasure] = []
    
    func startTreasureHunt() {
        // 1. AR„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßã
        let configuration = ARWorldTrackingConfiguration()
        configuration.planeDetection = [.horizontal, .vertical]
        sceneView.session.run(configuration)
        
        // 2. ËøëÈö£ÂÆùÁÆ±ÂèñÂæó
        loadNearbyTreasures()
        
        // 3. ARÂÆùÁÆ±ÈÖçÁΩÆ
        placeTreasuresInAR()
    }
    
    private func placeTreasuresInAR() {
        for treasure in treasures {
            let treasureNode = createTreasureNode(treasure)
            let anchor = ARAnchor(transform: treasure.transform)
            sceneView.session.add(anchor: anchor)
        }
    }
}
```

#### ‰ΩçÁΩÆÊÉÖÂ†±„Ç≤„Éº„É†„Ç®„É≥„Ç∏„É≥
```swift
class LocationGameEngine {
    private let gameRadius: CLLocationDistance = 100 // 100mÁØÑÂõ≤
    
    func findNearbyPlayers() async -> [User] {
        guard let location = locationManager.location else { return [] }
        
        // Supabase Realtime„ÅßËøëÊé•„É¶„Éº„Ç∂„ÉºÊ§úÁ¥¢
        let nearbyUsers = try await supabase
            .from("user_locations")
            .select("*")
            .execute()
            .value
        
        return nearbyUsers.filter { user in
            location.distance(from: user.location) <= gameRadius
        }
    }
    
    func initiatePanoramaSession(with users: [User]) async {
        // 1. „Çª„ÉÉ„Ç∑„Éß„É≥‰ΩúÊàê
        let session = PanoramaSession(participants: users)
        
        // 2. ÂèÇÂä†ËÄÖ„Å´ÈÄöÁü•
        for user in users {
            await notifyUser(user, session: session)
        }
        
        // 3. ÂêåÊúü„Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥ÈñãÂßã
        await startSynchronizedCountdown()
    }
}
```

### „Éë„Éé„É©„ÉûÊíÆÂΩ±„Ç∑„Çπ„ÉÜ„É†
```swift
class PanoramaCapture {
    private var captureSession: AVCaptureSession
    private var photoOutput: AVCapturePhotoOutput
    
    func captureSynchronizedPhotos() async -> [UIImage] {
        var photos: [UIImage] = []
        
        // ÂêåÊúüÊíÆÂΩ±
        for participant in session.participants {
            let photo = await capturePhotoFromParticipant(participant)
            photos.append(photo)
        }
        
        // „Éë„Éé„É©„ÉûÂêàÊàê
        let panorama = await stitchPhotos(photos)
        return panorama
    }
    
    private func stitchPhotos(_ photos: [UIImage]) async -> UIImage {
        // OpenCV or Core Image„Åß„Éë„Éé„É©„ÉûÂêàÊàê
        // 1. ÁâπÂæ¥ÁÇπÊ§úÂá∫
        // 2. „Éû„ÉÉ„ÉÅ„É≥„Ç∞
        // 3. „Éõ„É¢„Ç∞„É©„Éï„Ç£Ë®àÁÆó
        // 4. ÁîªÂÉèÂêàÊàê
    }
}
```

## üóÑÔ∏è „Éá„Éº„Çø„Éô„Éº„ÇπË®≠Ë®à

### Supabase Schema
```sql
-- „É¶„Éº„Ç∂„Éº„Éó„É≠„Éï„Ç£„Éº„É´Êã°Âºµ
ALTER TABLE profiles ADD COLUMN 
    game_level INTEGER DEFAULT 1,
    total_score INTEGER DEFAULT 0,
    badges_earned TEXT[] DEFAULT '{}',
    premium_expires_at TIMESTAMP;

-- ÂÜôÁúüÁ∑®ÈõÜÂ±•Ê≠¥
CREATE TABLE photo_edits (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
    post_id UUID REFERENCES posts(id) ON DELETE CASCADE,
    filter_name VARCHAR(100) NOT NULL,
    parameters JSONB DEFAULT '{}',
    processing_time_ms INTEGER,
    created_at TIMESTAMP DEFAULT NOW()
);

-- „Ç≤„Éº„É†„Çª„ÉÉ„Ç∑„Éß„É≥
CREATE TABLE game_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
    game_type game_type_enum NOT NULL,
    status session_status_enum DEFAULT 'active',
    score INTEGER DEFAULT 0,
    duration_seconds INTEGER,
    location POINT, -- PostGIS
    metadata JSONB DEFAULT '{}',
    started_at TIMESTAMP DEFAULT NOW(),
    completed_at TIMESTAMP
);

-- ARÂÆùÁÆ±
CREATE TABLE ar_treasures (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    treasure_type treasure_type_enum NOT NULL,
    latitude DECIMAL(10, 8) NOT NULL,
    longitude DECIMAL(11, 8) NOT NULL,
    altitude DECIMAL(8, 2) DEFAULT 0,
    difficulty_level INTEGER DEFAULT 1,
    reward_points INTEGER DEFAULT 10,
    found_by UUID[] DEFAULT '{}',
    max_finds INTEGER DEFAULT 10,
    expires_at TIMESTAMP,
    created_by UUID REFERENCES profiles(id),
    created_at TIMESTAMP DEFAULT NOW(),
    
    CONSTRAINT valid_coordinates CHECK (
        latitude BETWEEN -90 AND 90 AND
        longitude BETWEEN -180 AND 180
    )
);

-- „Éë„Éé„É©„Éû„Çª„ÉÉ„Ç∑„Éß„É≥  
CREATE TABLE panorama_sessions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    initiator_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
    session_code VARCHAR(8) UNIQUE NOT NULL,
    max_participants INTEGER DEFAULT 6,
    participants UUID[] DEFAULT '{}',
    photo_urls TEXT[] DEFAULT '{}',
    result_panorama_url TEXT,
    location POINT,
    status session_status_enum DEFAULT 'waiting',
    expires_at TIMESTAMP DEFAULT (NOW() + INTERVAL '1 hour'),
    created_at TIMESTAMP DEFAULT NOW()
);

-- „É¶„Éº„Ç∂„ÉºÂÆüÁ∏æ
CREATE TABLE user_achievements (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES profiles(id) ON DELETE CASCADE,
    achievement_type achievement_type_enum NOT NULL,
    earned_at TIMESTAMP DEFAULT NOW(),
    game_session_id UUID REFERENCES game_sessions(id),
    metadata JSONB DEFAULT '{}',
    
    UNIQUE(user_id, achievement_type)
);

-- EnumÂÆöÁæ©
CREATE TYPE game_type_enum AS ENUM (
    'treasure_hunt',
    'panorama_capture',
    'filter_challenge'
);

CREATE TYPE session_status_enum AS ENUM (
    'waiting',
    'active', 
    'completed',
    'expired',
    'cancelled'
);

CREATE TYPE treasure_type_enum AS ENUM (
    'bronze',
    'silver', 
    'gold',
    'diamond',
    'special_event'
);

CREATE TYPE achievement_type_enum AS ENUM (
    'retro_master',
    'explorer',
    'team_worker',
    'influencer',
    'legend'
);
```

### „Ç§„É≥„Éá„ÉÉ„ÇØ„ÇπÊúÄÈÅ©Âåñ
```sql
-- ‰ΩçÁΩÆÊ§úÁ¥¢ÊúÄÈÅ©Âåñ
CREATE INDEX idx_ar_treasures_location ON ar_treasures USING GIST (
    ST_Point(longitude, latitude)
);

-- „Ç≤„Éº„É†„Çª„ÉÉ„Ç∑„Éß„É≥Ê§úÁ¥¢
CREATE INDEX idx_game_sessions_user_type ON game_sessions (user_id, game_type);
CREATE INDEX idx_game_sessions_location ON game_sessions USING GIST (location);

-- ÂÜôÁúüÁ∑®ÈõÜÂ±•Ê≠¥
CREATE INDEX idx_photo_edits_user_created ON photo_edits (user_id, created_at DESC);

-- „Éë„Éé„É©„Éû„Çª„ÉÉ„Ç∑„Éß„É≥
CREATE INDEX idx_panorama_sessions_code ON panorama_sessions (session_code);
CREATE INDEX idx_panorama_sessions_location ON panorama_sessions USING GIST (location);
```

## üîÑ „É™„Ç¢„É´„Çø„Ç§„É†ÈÄö‰ø°‰ªïÊßò

### Supabase RealtimeÁµ±Âêà
```swift
class RealtimeGameService {
    private var client: SupabaseClient
    private var gameChannel: RealtimeChannelV2?
    
    func subscribeTo

GameUpdates() async {
        gameChannel = client.realtimeV2.channel("game_updates")
        
        // ARÂÆùÁÆ±Áô∫Ë¶ã„Ç§„Éô„É≥„Éà
        await gameChannel?.on(.insert, table: "ar_treasure_finds") { message in
            await self.handleTreasureFound(message)
        }
        
        // „Éë„Éé„É©„Éû„Çª„ÉÉ„Ç∑„Éß„É≥Êõ¥Êñ∞
        await gameChannel?.on(.update, table: "panorama_sessions") { message in
            await self.handlePanoramaUpdate(message)
        }
        
        // ËøëÊé•„É¶„Éº„Ç∂„ÉºÊ§úÂá∫
        await gameChannel?.on(.insert, table: "user_locations") { message in
            await self.handleNearbyUser(message)
        }
        
        await gameChannel?.subscribe()
    }
}
```

## üõ°Ô∏è „Çª„Ç≠„É•„É™„ÉÜ„Ç£ÂÆüË£Ö

### Row Level Security (RLS)
```sql
-- „Éó„É≠„Éï„Ç£„Éº„É´„Ç¢„ÇØ„Çª„ÇπÂà∂Âæ°
CREATE POLICY "Users can read own profile" ON profiles
    FOR SELECT USING (auth.uid() = id);

CREATE POLICY "Users can update own profile" ON profiles  
    FOR UPDATE USING (auth.uid() = id);

-- „Ç≤„Éº„É†„Çª„ÉÉ„Ç∑„Éß„É≥„Ç¢„ÇØ„Çª„ÇπÂà∂Âæ°
CREATE POLICY "Users can read own game sessions" ON game_sessions
    FOR SELECT USING (auth.uid() = user_id);

-- ARÂÆùÁÆ±„ÅÆÁô∫Ë¶ãË®òÈå≤
CREATE POLICY "Users can insert treasure finds" ON ar_treasure_finds
    FOR INSERT WITH CHECK (auth.uid() = user_id);

-- „Éë„Éé„É©„Éû„Çª„ÉÉ„Ç∑„Éß„É≥ÂèÇÂä†Âà∂Âæ°
CREATE POLICY "Participants can read panorama session" ON panorama_sessions
    FOR SELECT USING (
        auth.uid() = initiator_id OR 
        auth.uid() = ANY(participants)
    );
```

### APIË™çË®º„ÉªË™çÂèØ
```swift
class SecureAPIService {
    private let client: SupabaseClient
    
    func authenticatedRequest<T>(_ request: @escaping () async throws -> T) async throws -> T {
        // JWT„Éà„Éº„ÇØ„É≥Ê§úË®º
        guard let token = await AuthManager.shared.currentSession?.accessToken else {
            throw APIError.unauthorized
        }
        
        // „É™„ÇØ„Ç®„Çπ„ÉàÂÆüË°å
        return try await request()
    }
    
    func uploadPhotoWithValidation(_ image: UIImage) async throws -> String {
        // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„É¢„Éá„É¨„Éº„Ç∑„Éß„É≥
        let moderationResult = await ContentModerationManager.shared.moderate(image)
        guard moderationResult.isApproved else {
            throw APIError.contentBlocked(moderationResult.reason)
        }
        
        // ÁîªÂÉè„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ
        return try await client.storage.from("photos").upload(
            path: generateSecurePath(),
            file: image.jpegData(compressionQuality: 0.8)!
        )
    }
}
```

## üìà „Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÊúÄÈÅ©Âåñ

### ÁîªÂÉèÂá¶ÁêÜÊúÄÈÅ©Âåñ
```swift
class OptimizedImageProcessor {
    private let processingQueue = DispatchQueue(
        label: "image.processing",
        qos: .userInitiated,
        attributes: .concurrent
    )
    
    func processImageAsync(_ image: UIImage) async -> UIImage {
        return await withCheckedContinuation { continuation in
            processingQueue.async {
                autoreleasepool {
                    let processed = self.applyOptimizedFilters(image)
                    continuation.resume(returning: processed)
                }
            }
        }
    }
    
    private func applyOptimizedFilters(_ image: UIImage) -> UIImage {
        // Core Image„Ç≥„É≥„ÉÜ„Ç≠„Çπ„ÉàÂÜçÂà©Áî®
        // Metal„Éê„ÉÉ„Éï„Ç°„Éó„Éº„É´‰ΩøÁî®
        // „É°„É¢„É™ÂäπÁéáÁöÑ„Å™Âá¶ÁêÜ„ÉÅ„Çß„Éº„É≥
    }
}
```

### „É°„É¢„É™ÁÆ°ÁêÜ
```swift
class ImageCache {
    private let cache = NSCache<NSString, UIImage>()
    
    init() {
        cache.countLimit = 50 // ÊúÄÂ§ß50Êûö
        cache.totalCostLimit = 100 * 1024 * 1024 // 100MB
        
        // „É°„É¢„É™Ë≠¶ÂëäÂØæÂøú
        NotificationCenter.default.addObserver(
            self,
            selector: #selector(clearCache),
            name: UIApplication.didReceiveMemoryWarningNotification,
            object: nil
        )
    }
}
```

---

## üìö Èñ¢ÈÄ£„Éâ„Ç≠„É•„É°„É≥„Éà

- [Product Expansion Requirements](product-expansion-requirements.md)
- [Security Requirements](security-requirements.md)
- [Legal Requirements](legal-requirements.md)
- [ADR-003: Gamification Strategy](../decisions/ADR-003-gamification-strategy.md)

## üë• „É¨„Éì„É•„Ç¢„Éº

**ÊäÄË°ìË≤¨‰ªªËÄÖ**: [ÊäÄË°ìË≤¨‰ªªËÄÖÂêç]  
**„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„Éà**: [„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉàÂêç]  
**„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç®„É≥„Ç∏„Éã„Ç¢**: [„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Ç®„É≥„Ç∏„Éã„Ç¢Âêç]  
**DevOps„Ç®„É≥„Ç∏„Éã„Ç¢**: [DevOps„Ç®„É≥„Ç∏„Éã„Ç¢Âêç]